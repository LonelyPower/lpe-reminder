# 正计时模块功能文档

## 概述
为 lpe-reminder 项目添加了正计时（Stopwatch）模块，与现有的倒计时（Countdown）模块并行运行，用户可在设置中切换模式。

## 新增文件

### 1. `src/composables/useStopwatch.ts`
正计时器核心逻辑，简化版计时器：
- `elapsedMs`: 已经过时间（毫秒）
- `isRunning`: 是否正在运行
- `start()`: 开始/继续计时
- `pause()`: 暂停计时
- `stop()`: 停止并重置到0

### 2. `src/components/StopwatchPanel.vue`
正计时器UI面板：
- 显示格式：HH:MM:SS（超过1小时时）或 MM:SS
- 绿色主题（区别于倒计时的蓝色）
- 状态：空闲 / 计时中 / 已暂停
- 按钮：开始/暂停 + 停止

## 修改的文件

### 1. `src/composables/useSettings.ts`
新增设置项：
```typescript
timerMode: "countdown" | "stopwatch"  // 默认 "countdown"
```

### 2. `src/components/SettingsDialog.vue`
- 添加计时器模式选择下拉框
- 工作时长和休息时长仅在倒计时模式下显示

### 3. `src/App.vue`
核心变更：
- 同时初始化 `timer`（倒计时）和 `stopwatch`（正计时）
- 根据 `settings.timerMode` 渲染对应面板
- 托盘事件（start/pause/reset）根据模式分发到不同的计时器
- 悬浮窗状态同步支持两种模式
- 托盘图标状态更新逻辑支持正计时

### 4. `src/components/FloatingWindow.vue`
重大更新以支持双模式：
- 新增 `timerMode`, `elapsedMs` 状态变量
- `displayTime`: 根据模式显示倒计时或正计时
- `stateColor`: 正计时用绿色系，倒计时保持原色
- `stateText`: 正计时显示"计时中/已暂停/空闲"
- 左键点击：开始/暂停（两种模式通用）
- 右键点击：正计时模式下停止，倒计时模式下显示主窗口

## 功能对比

| 功能 | 倒计时模式 | 正计时模式 |
|------|-----------|-----------|
| 计时方向 | 从设定值向0倒数 | 从0正向累加 |
| 工作/休息切换 | ✓ 自动切换 | ✗ 无 |
| 主要操作 | 开始/暂停/重置 | 开始/暂停/停止 |
| 进度条 | ✓ 显示 | ✗ 无 |
| 轮次计数 | ✓ 显示 | ✗ 无 |
| 主题色 | 蓝/橙/绿 | 绿/灰 |
| 托盘图标状态 | idle/working/paused/break | idle/working/paused |

## 交互说明

### 主界面
- **倒计时模式**: 显示 `TimerPanel` 组件，保持原有功能
- **正计时模式**: 显示 `StopwatchPanel` 组件，简化界面

### 托盘
- **开始工作**: 根据当前模式启动对应计时器
- **暂停**: 暂停当前计时器
- **重置/停止**: 倒计时模式重置，正计时模式停止归零

### 悬浮窗
- **左键点击**: 开始/暂停计时（两种模式通用）
- **右键点击**: 
  - 正计时模式：停止计时（仅当计时器非空闲时）
  - 倒计时模式：显示主窗口
- **颜色指示**:
  - 蓝色：空闲
  - 绿色：正计时运行中
  - 橙色：倒计时工作中
  - 灰色：已暂停

## 技术实现要点

1. **状态隔离**: 两个计时器完全独立，切换模式不会相互影响
2. **事件分发**: App.vue 根据 `settings.timerMode` 将事件路由到正确的计时器
3. **悬浮窗同步**: 使用统一的 `timer-state-sync` 事件，payload 包含 `timerMode` 字段区分
4. **向后兼容**: 倒计时功能保持不变，新增正计时不影响现有用户体验

## 未来扩展建议

1. **正计时目标设置**: 可设置目标时长，到达时提醒
2. **历史记录**: 保存每次计时的时长记录
3. **标签分类**: 为不同任务打标签统计时长
4. **统计图表**: 展示每日/每周计时统计
